<head>
    <meta charset="UTF-8">
    <title>FriendFinder</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" integrity="sha384-zF4BRsG/fLiTGfR9QL82DrilZxrwgY/+du4p/c7J72zZj+FLYq4zY00RylP9ZjiT" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

<body>

  <div class="container">

    <h2>Survey Questions</h2>
    <hr>

    <h3><strong>About You</strong></h3>
    <h4>Name (Required)</h4>
    <input type="text" id="name" class="form-control" required="">

    <h4>Link to Photo Image (Required)</h4>
    <input type="text" id="photo" class="form-control" required="">

    <hr>

    <h3><strong>Question 1</strong></h3>
    <h4>How do you feel about putting pineapple on pizza?</h4>
    <select class="chosen-select" id="q1">
      <option value=""></option>
      <option value="1">1 (Absolutely Disgusting! Fruit has no place on a pizza.)</option>
      <option value="2">2</option>
      <option value="3">3 (I'll just pick them off and ignore the sweet juices still left behind)</option>
      <option value="4">4</option>
      <option value="5">5 (Really Freaking Great!  Also, I'm insane.)</option>
    </select>

    <h3><strong>Question 2</strong></h3>
    <h4>Is cereal soup?</h4>
    <select class="chosen-select" id="q2">
      <option value=""></option>
      <option value="1">1 (What? Are you crazy?)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Hmmmm....now that you mention it, that sorta makes sense!)</option>
    </select>


    <h3><strong>Question 3</strong></h3>
    <h4>Coffee or Tea?</h4>
    <select class="chosen-select" id="q3">
      <option value=""></option>
      <option value="1">1 (Only Coffee, always coffee.)</option>
      <option value="2">2</option>
      <option value="3">3 (I'm cool with either, just give me the caffeine!)</option>
      <option value="4">4</option>
      <option value="5">5 (I'm marginally psychotic and only like tea.)</option>
    </select>


    <h3><strong>Question 4</strong></h3>
    <h4>How much do you hate surveys?</h4>
    <select class="chosen-select" id="q4">
      <option value=""></option>
      <option value="1">1 (They're the bane of my existence and a waste of time!)</option>
      <option value="2">2</option>
      <option value="3">3 (You know, it's like....whatver, I guess...)</option>
      <option value="4">4</option>
      <option value="5">5 (I love answering questions that have no real meaning to me!)</option>
    </select>


    <h3><strong>Question 5</strong></h3>
    <h4>AMD or Intel?</h4>
    <select class="chosen-select" id="q5">
      <option value=""></option>
      <option value="1">1 (I like garbage PCs, so bring me that AMD!)</option>
      <option value="2">2</option>
      <option value="3">3 (I just need the stupid PC to work, so I don't really care.)</option>
      <option value="4">4</option>
      <option value="5">5 (I respect myself and use only Intel CPUs.)</option>
    </select>


    <h3><strong>Question 6</strong></h3>
    <h4>Star Trek Science Officer or Command Officer?</h4>
    <select class="chosen-select" id="q6">
      <option value=""></option>
      <option value="1">1 (Blue is my jam, so let's make it Science Officer!)</option>
      <option value="2">2</option>
      <option value="3">3 (Huh?  I'd rather red shirt myself off this question.)</option>
      <option value="4">4</option>
      <option value="5">5 (I look killer in gold, so let's be besties with Kirk.)</option>
    </select>


    <h3><strong>Question 7</strong></h3>
    <h4>Dark or Light side of the Force?</h4>
    <select class="chosen-select" id="q7">
      <option value=""></option>
      <option value="1">1 (I want true power, so give me all that red lightning goodness with the Dark.)</option>
      <option value="2">2</option>
      <option value="3">3 (I'm a complex character.  Depending on whether I had my coffe, I may either help you or kill you.)</option>
      <option value="4">4</option>
      <option value="5">5 (I'm boring and don't like stuff, so I guess I'll go for the Light.)</option>
    </select>

    <h3><strong>Question 8</strong></h3>
    <h4>Thoughts on Slytherin?</h4>
    <select class="chosen-select" id="q8">
      <option value=""></option>
      <option value="1">1 (The BEST and ONLY house that one should belong to.)</option>
      <option value="2">2 </option>
      <option value="3">3 (They're jerks, but I guess they're ok as an ally.)</option>
      <option value="4">4 </option>
      <option value="5">5 (I'm a pleb and only really like/know of Gryffindor.)</option>
    </select>

    <h3><strong>Question 9</strong></h3>
    <h4>I would walk 500 miles...</h4>
    <select class="chosen-select" id="q9">
      <option value=""></option>
      <option value="1">1 (And I would walk 500 more!)</option>
      <option value="2">2</option>
      <option value="3">3 (Huh?)</option>
      <option value="4">4</option>
      <option value="5">5 (I know the answer to this question, but I refuse to select it out of self-respect.)</option>
    </select>

    <h3><strong>Question 10</strong></h3>
    <h4>Was this survey was a good use of my time?</h4>
    <select class="chosen-select" id="q10">
      <option value=""></option>
      <option value="1">1 (I will never get back these 5 minutes, and I'm pissed. I will make you pay!)</option>
      <option value="2">2</option>
      <option value="3">3 (Complete, and utter waste. Why, oh why did I need to take this survey.)</option>
      <option value="4">4</option>
      <option value="5">5 (I honestly didn't read the questions, so who cares.)</option>
    </select>

    <br>
    <br>

    <!-- Submit Button -->
    <button type="button" id="submit" class="btn btn-success btn-lg btn-block" data-toggle="modal" data-target="#modal"><i class="fa fa-check-square" aria-hidden="true"></i> Submit</button>

    <hr>
    <footer class="footer">
      <div class="container">
        <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/kilcannon/friend-finder">GitHub Repo</a></p>
      </div>
    </footer>

  </div>

    <div class="modal fade" id="modal" role="dialog">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
    // declare global variables
    var nameVal
    var imageVal
    var q1Val
    var q2Val
    var q3Val
    var q4Val
    var q5Val
    var q6Val
    var q7Val
    var q8Val
    var q9Val
    var q10Val
    var newPerson
    $('#submit').on('click', function(event) {
        event.preventDefault()

        nameVal = $('#name').val()
        imageVal = $('#image').val()
        q1Val = parseInt($('#q1').val())
        q2Val = parseInt($('#q2').val())
        q3Val = parseInt($('#q3').val())
        q4Val = parseInt($('#q4').val())
        q5Val = parseInt($('#q5').val())
        q6Val = parseInt($('#q6').val())
        q7Val = parseInt($('#q7').val())
        q8Val = parseInt($('#q8').val())
        q9Val = parseInt($('#q9').val())
        q10Val = parseInt($('#q10').val())
        newPerson = {
            name: nameVal,
            image: imageVal,
            responses: [q1Val, q2Val, q3Val, q4Val, q5Val, q6Val, q7Val, q8Val, q9Val, q10Val],
            total: q1Val + q2Val + q3Val + q4Val + q5Val + q6Val + q7Val + q8Val + q9Val + q10Val
        }

        var modalTitle = $('.modal-title')
        var modalBody = $('.modal-body')
        var modal = $('#modal')
        if (formIsValid()) {
            $.get("/api/friends", function(data) {
                var match = makeMatch(data)
                if (match.name !== undefined) {
                    modalTitle.text('You have a match!')
                    modalBody.html('<p class="strong">You\'re most compatible with:</p><p>' + match.name + '</p><img src="' + match.image + '" height="200">')
                } else {
                    modalTitle.text('Too few friends')
                    modalBody.text('Sorry, there are too few friends to match you with.')
                }
            }).then(function() {
                modal.show()
                $('.form')[0].reset()
                $.post("/api/friends", newPerson)
            })
        } else {
            modalTitle.text('Error')
            modalBody.text('Please make sure all questions have been filled in.')
            modal.show()
        }
    })
    function formIsValid() {
        return (nameVal !== '' && imageVal !== '' && !isNaN(q1Val) && !isNaN(q2Val) && !isNaN(q3Val) && !isNaN(q4Val) &&
            !isNaN(q5Val) && !isNaN(q6Val) && !isNaN(q7Val) && !isNaN(q8Val) && !isNaN(q9Val) && !isNaN(q10Val))
    }
    function makeMatch(data) {
        var difference = 50
        var minName
        var minImage
        data.forEach(function(person) {
            var localDiff = Math.abs(newPerson.total - person.total)
            console.log(localDiff)
            if (localDiff < difference) {
                difference = localDiff
                minName = person.name
                minImage = person.photo
            }
        })
        return {
            name: minName,
            image: minImage
        }
    }
    </script>
</body>

</html>